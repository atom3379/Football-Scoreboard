<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Control Panel</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body{
  font-family:Arial;
  padding:20px;
  background:#f5f5f5;
}

h2,h3{
  margin-top:25px;
}

button,input{
  margin:5px;
  padding:6px 10px;
}

.section{
  background:#ffffff;
  padding:15px;
  margin-bottom:20px;
  border:1px solid #ddd;
}
</style>
</head>
<body>

<h2>CONTROL PANEL</h2>

<div class="section">
<h3>League Logo (Upload from PC)</h3>
<input type="file" id="logoFile">
<button onclick="uploadLogo()">Upload</button>
</div>

<div class="section">
<h3>Team 1</h3>
<input id="t1name" placeholder="Name">
<input type="color" id="t1color">
<button onclick="updateTeam(1)">Update</button>
<button onclick="score(1,1)">+1</button>
<button onclick="score(1,-1)">-1</button>
</div>

<div class="section">
<h3>Team 2</h3>
<input id="t2name" placeholder="Name">
<input type="color" id="t2color">
<button onclick="updateTeam(2)">Update</button>
<button onclick="score(2,1)">+1</button>
<button onclick="score(2,-1)">-1</button>
</div>

<div class="section">
<h3>Score Control</h3>
<button onclick="resetScore()">Reset Score</button>
</div>

<div class="section">
<h3>Clock</h3>
<button onclick="start()">Start</button>
<button onclick="stop()">Stop</button>
<button onclick="resetTime()">Reset to 00:00</button>
<button onclick="startSecondHalf()">Start 2nd Half (45:00)</button>
</div>

<div class="section">
<h3>Extra Time</h3>
<input type="number" id="extraInput" placeholder="Extra minutes">
<button onclick="setExtra()">Set</button>
</div>

<script>
const socket = io();
let current = {};

socket.on("update", d => {
  current = d;
});

// ---------- LOGO ----------
function uploadLogo(){
  const file = document.getElementById("logoFile").files[0];
  if(!file) return;

  const formData = new FormData();
  formData.append("logo", file);

  fetch("/uploadLogo",{
    method:"POST",
    body:formData
  });
}

// ---------- TEAM UPDATE ----------
function updateTeam(n){
  if(n === 1){
    socket.emit("updateMatch",{
      team1Name: document.getElementById("t1name").value,
      team1Color: document.getElementById("t1color").value
    });
  }else{
    socket.emit("updateMatch",{
      team2Name: document.getElementById("t2name").value,
      team2Color: document.getElementById("t2color").value
    });
  }
}

// ---------- SCORE ----------
function score(team, amt){

  // ยิง event animation ก่อน
  socket.emit("goal", team);

    if(team === 1){
      socket.emit("updateMatch",{
        team1Score: Math.max(0, current.team1Score + amt)
      });
    }else{
      socket.emit("updateMatch",{
        team2Score: Math.max(0, current.team2Score + amt)
      });
    }


}

// ---------- CLOCK ----------
function start(){
  socket.emit("start");
}

function stop(){
  socket.emit("stop");
}

function resetTime(){
  socket.emit("stop");
  socket.emit("updateMatch",{
    seconds:0,
    extra:0
  });
}

function startSecondHalf(){
  socket.emit("stop");
  socket.emit("updateMatch",{
    seconds:45*60,
    extra:0
  });
}

// ---------- EXTRA ----------
function setExtra(){
  const value = Number(document.getElementById("extraInput").value);
  socket.emit("updateMatch",{
    extra: value > 0 ? value : 0
  });
}
</script>

</body>
</html>