<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Control Panel</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body {
  font-family: Arial;
  padding: 20px;
  background: #f5f5f5;
}

h2, h3 {
  margin-top: 25px;
}

button, input, select {
  margin: 5px;
  padding: 6px 10px;
}

.section {
  background: #ffffff;
  padding: 15px;
  margin-bottom: 20px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.card-btn-yellow {
  background: #FDD835;
  color: #000;
  font-weight: bold;
  border: none;
  cursor: pointer;
  border-radius: 3px;
}

.card-btn-red {
  background: #E53935;
  color: #fff;
  font-weight: bold;
  border: none;
  cursor: pointer;
  border-radius: 3px;
}
</style>
</head>
<body>

<h2>âš½ CONTROL PANEL</h2>

<!-- SUBSTITUTION SECTION -->
<div class="section">
  <h3>ğŸ”„ Substitution</h3>
  <select id="subTeam">
    <option value="1">Team 1</option>
    <option value="2">Team 2</option>
  </select>
  <br>
  <label>â–² In:</label>
  <input id="subNumberIn"  placeholder="#Number" style="width:80px;">
  <input id="subNameIn"    placeholder="Player Name" style="width:150px;">
  <br>
  <label>â–¼ Out:</label>
  <input id="subNumberOut" placeholder="#Number" style="width:80px;">
  <input id="subNameOut"   placeholder="Player Name" style="width:150px;">
  <br>
  <button onclick="sendSub()" style="margin-top:6px;">ğŸ”„ Send Substitution</button>
</div>


<!-- CARD SECTION -->
<div class="section">
  <h3>ğŸŸ¨ Card</h3>
  <select id="cardTeam">
    <option value="1">Team 1</option>
    <option value="2">Team 2</option>
  </select>
  <input id="cardNumber" placeholder="#Number" style="width:80px;">
  <input id="cardName"   placeholder="Player Name" style="width:150px;">
  <br>
  <button class="card-btn-yellow" onclick="sendCard('Yellow Card')">ğŸŸ¨ Yellow Card</button>
  <button class="card-btn-red"    onclick="sendCard('Red Card')">ğŸŸ¥ Red Card</button>
</div>

<!-- LOGO -->
<div class="section">
  <h3>ğŸ† League Logo</h3>
  <input type="file" id="logoFile">
  <button onclick="uploadLogo()">Upload</button>
</div>

<!-- TEAM 1 -->
<div class="section">
  <h3>Team 1</h3>
  <input id="t1name"      placeholder="Full Name">
  <input id="t1shortName" placeholder="Short (3 letters)">
  <input type="color" id="t1color" value="#1e88e5">
  <button onclick="updateTeam(1)">Update</button>
  <button onclick="score(1, 1)">+1 Goal</button>
  <button onclick="score(1, -1)">-1 Goal</button>
</div>

<!-- TEAM 2 -->
<div class="section">
  <h3>Team 2</h3>
  <input id="t2name"      placeholder="Full Name">
  <input id="t2shortName" placeholder="Short (3 letters)">
  <input type="color" id="t2color" value="#fdd835">
  <button onclick="updateTeam(2)">Update</button>
  <button onclick="score(2, 1)">+1 Goal</button>
  <button onclick="score(2, -1)">-1 Goal</button>
</div>

<!-- SCORE RESET -->
<div class="section">
  <h3>Score</h3>
  <button onclick="resetScore()">Reset Score (0-0)</button>
</div>

<!-- CLOCK -->
<div class="section">
  <h3>â± Clock</h3>
  <button onclick="start()">â–¶ Start</button>
  <button onclick="stop()">â¸ Stop</button>
  <button onclick="resetTime()">â†º Reset 00:00</button>
  <button onclick="startSecondHalf()">2nd Half (45:00)</button>
</div>

<!-- EXTRA TIME -->
<div class="section">
  <h3>Extra Time</h3>
  <input type="number" id="extraInput" placeholder="Extra minutes" style="width:130px;">
  <button onclick="setExtra()">Set</button>
</div>

<script>
const socket = io();
let current = {};

socket.on("update", d => {
  current = d;
});

// ---- SUBSTITUTION ----
function sendSub() {
  const team      = document.getElementById("subTeam").value;
  const nameIn    = document.getElementById("subNameIn").value.trim();
  const numberIn  = document.getElementById("subNumberIn").value.trim();
  const nameOut   = document.getElementById("subNameOut").value.trim();
  const numberOut = document.getElementById("subNumberOut").value.trim();

  if (!nameIn && !nameOut) {
    alert("Please enter at least one player name.");
    return;
  }

  socket.emit("sub", { team, nameIn, numberIn, nameOut, numberOut });
}

// ---- CARD ----
function sendCard(type) {
  const team   = document.getElementById("cardTeam").value;
  const name   = document.getElementById("cardName").value.trim();
  const number = document.getElementById("cardNumber").value.trim();

  if (!name && !number) {
    alert("Please enter player name or number.");
    return;
  }

  socket.emit("card", { team, type, name, number });
}

// ---- LOGO ----
function uploadLogo() {
  const file = document.getElementById("logoFile").files[0];
  if (!file) return;
  const formData = new FormData();
  formData.append("logo", file);
  fetch("/uploadLogo", { method: "POST", body: formData });
}

// ---- TEAM UPDATE ----
function updateTeam(n) {
  if (n === 1) {
    socket.emit("updateMatch", {
      team1Name:  document.getElementById("t1name").value      || current.team1Name,
      team1Short: document.getElementById("t1shortName").value || current.team1Short,
      team1Color: document.getElementById("t1color").value
    });
  } else {
    socket.emit("updateMatch", {
      team2Name:  document.getElementById("t2name").value      || current.team2Name,
      team2Short: document.getElementById("t2shortName").value || current.team2Short,
      team2Color: document.getElementById("t2color").value
    });
  }
}

// ---- SCORE ----
function score(team, delta) {
  const key   = "team" + team + "Score";
  const value = Math.max(0, (current[key] || 0) + delta);
  socket.emit("updateMatch", { [key]: value });
}

function resetScore() {
  socket.emit("updateMatch", { team1Score: 0, team2Score: 0 });
}

// ---- CLOCK ----
function start()          { socket.emit("start"); }
function stop()           { socket.emit("stop"); }

function resetTime() {
  socket.emit("stop");
  socket.emit("updateMatch", { seconds: 0, extra: 0 });
}

function startSecondHalf() {
  socket.emit("stop");
  socket.emit("updateMatch", { seconds: 45 * 60, extra: 0 });
}

// ---- EXTRA ----
function setExtra() {
  const val = Number(document.getElementById("extraInput").value);
  socket.emit("updateMatch", { extra: val > 0 ? val : 0 });
}
</script>

</body>
</html>
