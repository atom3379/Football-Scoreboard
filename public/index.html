<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="/socket.io/socket.io.js"></script>
<style>
body{
  margin:0;
  background:#111;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.board{
  display:flex;
  align-items:flex-start;
}

.leftPanel{
  display:flex;
  flex-direction:column;
  align-items:center;
  margin-right:10px;
}

.leagueLogo{
  width:120px;
  height:120px;
  background:#333;
  overflow:hidden;
}

.leagueLogo img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.timebox{
  width:120px;
  height:50px;
  background:#222;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:22px;
  font-weight:bold;
  position:relative;
}

.extraBox{
  position:absolute;
  bottom:-25px;
  background:#e53935;
  color:#fff;
  padding:4px 15px;
  font-size:16px;
  font-weight:bold;
  display:none;
}

/* -------- SCORE AREA -------- */

.scoreBoard{
  position:relative;
  width:380px;
  overflow:hidden; /* สำคัญมาก รถไฟโดนตัดตรงนี้ */
}

.team{
  display:flex;
  align-items:center;
  padding:15px 20px;
  font-size:26px;
  font-weight:bold;
  color:#ffffff;
}

.team-stroke{
  display:flex;
  align-items:center;
  padding:15px 20px;
  font-size:21px;
  font-weight:bold;
  color:#000000;
}


.score{
  margin-right:6px;
  font-size:30px;
}

/* -------- GOAL TRAIN -------- */

.goalOverlay{
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:70px;
  font-weight:bold;
  color:#fff;
  background:#222;
  pointer-events:none;
  box-sizing:border-box;
}

.goalOverlay span{
  display:inline-block;
  transition:transform 0.5s ease;
}

/* เส้นสีทีม */
.goalOverlay{
  border-left:15px solid;
  border-right:15px solid;
}

/* รถไฟวิ่งผ่านแล้วหายเพราะโดน clip */
.slide{
  animation:trainMove 1.4s forwards;
}

@keyframes trainMove{
  0%{
    left:-100%;
  }

  40%{
    left:0;
  }

  65%{
    left:0;   /* ค้างกลาง */
  }

  100%{
    left:100%;
  }
}
</style>
</head>
<body>

<div class="board">

  <div class="leftPanel">
    <div class="leagueLogo">
      <img id="leagueImg">
    </div>

    <div class="timebox">
      <span id="time"></span>
      <div id="extraBox" class="extraBox"></div>
    </div>
  </div>

  <div class="scoreBoard">

    <div id="goalBox" class="goalOverlay" style="display:none;">
      <span>G</span>
      <span>O</span>
      <span>A</span>
      <span>L</span>
    </div>

    <div id="team1" class="team">
      <div class="score" id="score1"></div>
      <div id="name1"></div>
    </div>

    <div id="team2" class="team">
      <div class="score" id="score2"></div>
      <div id="name2"></div>
    </div>

  </div>

</div>

<script>
const socket = io();

let lastScore1 = null;
let lastScore2 = null;

socket.on("update", d => {

  name1.textContent = d.team1Name;
  name2.textContent = d.team2Name;

  score1.textContent = d.team1Score;
  score2.textContent = d.team2Score;

  team1.style.background = d.team1Color;
  team2.style.background = d.team2Color;

  let m = Math.floor(d.seconds/60);
  let s = d.seconds%60;
  time.textContent =
    String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");

  if(d.extra>0){
    extraBox.style.display="block";
    extraBox.textContent="+"+d.extra+"'";
  }else{
    extraBox.style.display="none";
  }

  if(d.leagueLogo){
    leagueImg.src=d.leagueLogo;
  }

  /* กัน animation ตอนโหลดครั้งแรก */
  if(lastScore1 === null){
    lastScore1 = d.team1Score;
    lastScore2 = d.team2Score;
    return;
  }

  if(d.team1Score > lastScore1){
    triggerGoal(d.team1Color);
  }

  if(d.team2Score > lastScore2){
    triggerGoal(d.team2Color);
  }

  lastScore1 = d.team1Score;
  lastScore2 = d.team2Score;
});

function triggerGoal(color){

  const box = document.getElementById("goalBox");
  const letters = box.querySelectorAll("span");

  // ตั้งค่าเริ่มต้น
  box.style.display = "flex";
  box.style.left = "-100%";
  box.style.borderLeftColor = color;
  box.style.borderRightColor = color;

  // รีสตาร์ท animation
  box.classList.remove("slide");
  void box.offsetWidth;
  box.classList.add("slide");

  // แยกตัวอักษร
  letters[0].style.transform="translateX(-50px)";
  letters[1].style.transform="translateX(-15px)";
  letters[2].style.transform="translateX(15px)";
  letters[3].style.transform="translateX(50px)";

  // รอจน animation จบจริง ๆ
  box.addEventListener("animationend", function handler(){
    box.style.display="none";
    letters.forEach(l=>l.style.transform="translateX(0)");
    box.removeEventListener("animationend", handler);
  });
}
</script>

</body>
</html>